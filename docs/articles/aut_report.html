<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Automating SDC report generation â€¢ agrisvyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Automating SDC report generation">
<meta property="og:description" content="agrisvyr">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">agrisvyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/agrisvyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/agrisvy_data.html">Generate simulated FAO AgriSurvey Data</a>
    </li>
    <li>
      <a href="../articles/agrisvy_tutorials.html">Practical learning tutorials</a>
    </li>
    <li>
      <a href="../articles/aut_report.html">Automating SDC report generation</a>
    </li>
    <li>
      <a href="../articles/sdc_agrisvy.html">Speed up microdata anonymization process</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Automating SDC report generation</h1>
            
      
      
      <div class="hidden name"><code>aut_report.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>After the anonymization, it is always important to write a technical
sdc report which highlight the different datasets anonymized, the sdc
methods that have been applied using sdcMicro package and onther ad-hoc
anonymization that have been applied as well. The report should also
include the analysis of SDC risk such as global risk, individual risk,
SUDA risk, hierarchical risk (if applicable). In agricultural survey we
may need to anonymized many dataset and writing the full report can be
time consuming.</p>
<p>In the agrisvy package provide a template for the main report, and if
a dataset is anonymized, main report can be appended with a simple R
function in order to include the risk analysis and a comparison between
the original risk and the final risk after SDC methods have been
applied.</p>
<p>This article shows how to create and append the main SDC reports.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">agrisvyr</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'sdcMicro::freq' by 'questionr::freq' when</span></span>
<span><span class="co">#&gt; loading 'agrisvyr'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'agrisvyr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     labels</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-anonymization-working-folders-and-files">Create anonymization working folders and files<a class="anchor" aria-label="anchor" href="#create-anonymization-working-folders-and-files"></a>
</h2>
<p>WHen creating the anonymization working folders and files, the
<code>agrisvyr</code> package create a template of report saved in the
forder dedicated to contain the anonymization report.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agrisvy</span> <span class="op">&lt;-</span> <span class="fu">agrisvyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/agrisvyr/man/createAgrisvy.html" class="external-link">createAgrisvy</a></span><span class="op">(</span></span>
<span>  svyName <span class="op">=</span> <span class="st">"Anual Agricultural survey (AAS) 2020"</span>,</span>
<span>  author <span class="op">=</span> <span class="st">"UBOS"</span>,</span>
<span>  language <span class="op">=</span> <span class="st">"en"</span>,</span>
<span>  workingDir <span class="op">=</span> <span class="st">"C:/Users/USER/OneDrive - Food and Agriculture Organization/agrisvyr_test/Uganda_2020/Anonymization"</span>,</span>
<span>  path <span class="op">=</span> <span class="st">"C:/Users/USER/OneDrive - Food and Agriculture Organization/agrisvyr_test/Uganda_2020/2_Cleaned data"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">".dta"</span>,</span>
<span>  varClassDir <span class="op">=</span> <span class="st">"01_Variable classification"</span>,</span>
<span>  preProcScriptDir <span class="op">=</span> <span class="st">"02_Pre-processing scripts"</span>,</span>
<span>  preprocDataDir <span class="op">=</span> <span class="st">"03_Pre-processed data"</span>,</span>
<span>  anoScriptDir <span class="op">=</span> <span class="st">"04_Anonymization scripts"</span>,</span>
<span>  anoDataDir <span class="op">=</span> <span class="st">"05_Anonymized data"</span>,</span>
<span>  anoreportDir <span class="op">=</span> <span class="st">"06_Anonymization report"</span>,</span>
<span>  fileDesDir <span class="op">=</span> <span class="st">"07_Files description"</span>,</span>
<span>  infoLossReport <span class="op">=</span> <span class="st">"08_Information loss report"</span>,</span>
<span>  tempfileDir <span class="op">=</span> <span class="st">"09_Temporary_files"</span>,</span>
<span>  aobDir <span class="op">=</span> <span class="st">"10_Miscellaneous"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># agrisvyr::setup_anonymization(agrisvy,overwrite = TRUE)</span></span></code></pre></div>
<p><img src="images/sdc_report_1.jpg" width="800px" height="600px"><img src="images/sdc_report_2.jpg" width="800px" height="600px"></p>
<p>The main template can be modified just by opening the rmarkdown
document. After having anonymized a microdata, the main report need to
be extended to integrate the risk analysis and the sdc methods applied
and the original/final risk comparison.</p>
</div>
<div class="section level2">
<h2 id="extending-the-sdc-report">Extending the sdc report<a class="anchor" aria-label="anchor" href="#extending-the-sdc-report"></a>
</h2>
<p>Let us anonymized the member dataset and extend the sdc report and
see the output.</p>
<p>The initial anonymization setup has already generated anonymization
scripts we can use directly. We will skip the pre-processing step and
anonymize the clean data as it is.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#'*|----------------------------------------------------------------------------|*</span></span>
<span><span class="co">#'*|--| Anonymization of Anual Agricultural survey (AAS) 2020                   |*</span></span>
<span><span class="co">#'*|--| Author: UBOS                                                            |*</span></span>
<span><span class="co">#'*|--| Date: 2022-11-30                                                        |*</span></span>
<span><span class="co">#'*|----------------------------------------------------------------------------|*</span></span>
<span><span class="co">#'*|--| Dataset: Season 1=&gt;PH=&gt;SEC2_V1_MEMBERS.dta                              |*</span></span>
<span><span class="co">#'*|----------------------------------------------------------------------------|*</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"agrisvy"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sdcTools/sdcMicro" class="external-link">sdcMicro</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org" class="external-link">haven</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://juba.github.io/questionr/" class="external-link">questionr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://larmarange.github.io/labelled/" class="external-link">labelled</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:/Users/USER/OneDrive - Food and Agriculture Organization/agrisvyr_test/Uganda_2020/Anonymization/_R"</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path<span class="op">=</span><span class="st">"C:/Users/USER/OneDrive - Food and Agriculture Organization/agrisvyr_test/Uganda_2020/Anonymization/_R"</span>,</span>
<span>            pattern <span class="op">=</span> <span class="st">".R$"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="va">source</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sdcMessage.html">sdcMessage</a></span><span class="op">(</span><span class="st">"Season 1=&gt;PH=&gt;SEC2_V1_MEMBERS.dta"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#*****************************************************************</span></span>
<span><span class="co"># Load microdata to be anonymized                                *</span></span>
<span><span class="co">#*****************************************************************</span></span>
<span></span>
<span><span class="va">inputdata</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/sdcMicro/man/readMicrodata.html" class="external-link">readMicrodata</a></span><span class="op">(</span>path<span class="op">=</span><span class="st">"03_Pre-processed data/Season 1/PH/SEC2_V1_MEMBERS_proc.dta"</span>,type<span class="op">=</span><span class="st">"stata"</span>, convertCharToFac<span class="op">=</span><span class="cn">FALSE</span>, drop_all_missings<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#*****************************************************************</span></span>
<span><span class="co"># Load variable classification                                   *</span></span>
<span><span class="co">#*****************************************************************</span></span>
<span><span class="va">variable_classification</span><span class="op">=</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span>path<span class="op">=</span><span class="st">"01_Variable classification/Season 1_PH_VarClas.xlsx"</span>,</span>
<span>                                   sheet <span class="op">=</span><span class="st">"SEC2_V1_MEMBERS"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Name</span><span class="op">:</span><span class="va">Questions</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ano_variable</span><span class="op">=</span><span class="va">variable_classification</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Classification</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Q"</span>,<span class="st">"L"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span></span>
<span><span class="va">ano_variable</span><span class="op">=</span><span class="va">ano_variable</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ano_variable</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">ano_variable</span></span>
<span></span>
<span><span class="co">#*****************************************************************</span></span>
<span><span class="co"># saving anonymized data                                         *</span></span>
<span><span class="co">#*****************************************************************</span></span>
<span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_dta.html" class="external-link">write_dta</a></span><span class="op">(</span><span class="va">inputdata</span>,<span class="st">"09_Temporary_files/temp_ano/Season 1/PH/SEC2_V1_MEMBERS_tmp.dta"</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Amsata Niang.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
